<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ù‡∏∏‡πà‡∏ô PM2.5 (WAQI API)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
/* ========================================================================= */
/* --- 1. CSS ‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á --- */
/* ========================================================================= */
body {
    font-family: 'Sarabun', sans-serif;
    background: #e0e0e0;
    margin: 0;
    padding: 20px;
}

/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Control Panel) */
.form-section {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid #ddd;
}

.infographic {  
    text-align: center; 
}

/* ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏µ‡∏£‡∏∏‡πâ‡∏á */
h2 {
    background: linear-gradient(90deg, #4caf50, #ffeb3b, #ff9800, #f44336, #9c27b0);
    color: #000;
    font-size: 46px;
    padding: 10px;
    border-radius: 8px;
    margin-top: -15px;
    margin-bottom: -1px;
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ */
button {
    padding: 12px 20px;
    margin-top: 10px;
    margin-right: 5px;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.2s;
}
button:hover { transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

.btn-gen { background: #2196f3; color: #fff; }    /* ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô */
.btn-save { background: #4caf50; color: #fff; }   /* ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û */
.btn-api { background: #ff9800; color: #fff; }    /* ‡∏î‡∏∂‡∏á API */

/* ========================================================================= */
/* --- 2. ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (A4) --- */
/* ========================================================================= */
.header-group {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 10px;
    margin-top: -30px;
    margin-bottom: -40px;
}

.logo-hrh { height: 90px; width: auto; }
.logo-occ { height: 138px; width: auto; margin-top: -6px; }

.header-text {
    margin-top: 20px;  
    text-align: left;
    font-size: 23px;
    font-weight: bold;
    color: #4a148c;
    line-height: 1.3;
    max-width: 550px; 
    text-shadow: 1px 1px 0 #fff;
    white-space: nowrap; 
}

/* ‡∏õ‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤ */
#areaValue::before { content: "üìç "; }
#dateValue::before { content: "üìÖ "; }
#timeValue::before { content: "‚è∞ "; }

#areaValue, #dateValue, #timeValue {
    font-size: 26px;
    font-weight: bold;
    color: #4a148c;
    background: #e1bee7;
    padding: 6px 12px;
    border-radius: 6px;
    margin: 4px;
    display: inline-block;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Layout 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
.main-content {
    display: flex;
    justify-content: space-between;
    align-items: stretch;
    margin-top: 5px;
    gap: 15px;
}

.stations { width: 55%; display: flex; flex-direction: column; }
.right-sidebar { width: 43%; display: flex; flex-direction: column; gap: 0; }

.right-sidebar .top-pic { 
    width: 100%;
    max-height: 450px;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô */
.station {
    margin: 0 0 15px 0;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    color: #fff; /* Default text white */
    width: 100%; 
    box-sizing: border-box;
    position: relative;
}

/* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á (‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÉ‡∏´‡∏°‡πà) */
.good { background: #2196f3; color: #fff; }       /* ‡∏ü‡πâ‡∏≤ */
.moderate { background: #4caf50; color: #fff; }    /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
.unhealthy { background: #ffeb3b; color: #000; }   /* ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á (‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏î‡∏≥) */
.very-unhealthy { background: #ff9800; color: #fff; } /* ‡∏™‡πâ‡∏° */
.hazardous { background: #f44336; color: #fff; }   /* ‡πÅ‡∏î‡∏á */

.station-name {
    font-size: 22px;
    font-weight: bold;
    margin-bottom: 5px;
    color: inherit; /* ‡∏ï‡∏≤‡∏°‡∏™‡∏µ‡πÅ‡∏°‡πà */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.pm-highlight {
    font-size: 24px;
    font-weight: bold;
    color: #0d47a1;
    background: rgba(255,255,255,0.8);
    padding: 10px;
    border-radius: 8px;
    margin: 8px 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.emoji {
    font-size: 40px;
    margin: 5px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.level-highlight {
    font-size: 24px;
    font-weight: bold;
    background: rgba(255,255,255,0.9);
    padding: 8px;
    border-radius: 8px;
    margin-top: 5px;
    color: #333;
    border: 2px solid rgba(0,0,0,0.1);
}

/* ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ */
.advice-img-standalone {
    width: 90%; 
    max-width: 800px;
    margin: -5px auto 0 auto; 
    display: block; 
}

.advice-table-img-fixed {
    width: 100%; 
    max-width: 900px; 
    max-height: 350px;
    object-fit: contain;
    margin: -15px auto 0 auto; 
    display: block; 
}

/* ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4 */
.a4 {
    width: 210mm;
    min-height: 297mm;
    background-image: url('assets/bg_pm25.jpg'); /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    background-size: cover;
    background-position: center bottom;
    background-repeat: no-repeat;
    margin: 0 auto;
    padding: 10mm;
    box-sizing: border-box;
    position: relative;
    background-color: white; /* Fallback */
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
}

/* Footer ‡∏ï‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á */
#report-footer-container {
    position: absolute;
    bottom: 5mm;
    left: 2mm;
    right: 2mm;
    text-align: center;
}
#contactFooter {
    font-size: 14px;
    font-weight: normal;
    background: rgba(255,255,255,0.9);
    padding: 5px 15px;
    border-radius: 20px;
    display: inline-block;
    border: 1px solid #ddd;
}

/* Responsive ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
@media (max-width: 600px) {
    .a4 { width: 100%; height: auto; padding: 10px; }
    .header-group { flex-direction: column; align-items: center; }
    .main-content { flex-direction: column; }
    .stations, .right-sidebar { width: 100%; }
}
</style>
</head>

<body onload="setInitialValues()">
    
    <div class="form-section">
        <h2 style="font-size: 28px; background: none; color: #333; padding: 0;">üõ†Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>
        <hr>
        
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <strong>üöÄ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (WAQI API):</strong><br>
            <button onclick="fetchWaqiData()" class="btn-api">üîÑ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å WAQI</button>
            <span id="api-status" style="font-size: 14px; color: #666; margin-left: 10px;"></span>
        </div>
        
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div>
                <label>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</label> 
                <select id="areaSelector" style="padding: 5px;">
                    <option value="‡∏ï.‡∏°‡∏≤‡∏ö‡∏ï‡∏≤‡∏û‡∏∏‡∏î/‡∏ï.‡∏´‡πâ‡∏ß‡∏¢‡πÇ‡∏õ‡πà‡∏á">‡∏ï.‡∏°‡∏≤‡∏ö‡∏ï‡∏≤‡∏û‡∏∏‡∏î/‡∏ï.‡∏´‡πâ‡∏ß‡∏¢‡πÇ‡∏õ‡πà‡∏á</option>
                    <option value="manual">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á...</option>
                </select>
                <input id="manualAreaInput" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà" style="display:none; margin-top:5px;">
            </div>
            <div>
                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label> <input id="date" type="date" style="padding: 5px;">
            </div>
            <div>
                <label>‡πÄ‡∏ß‡∏•‡∏≤:</label> 
                <input id="hour" type="number" min="0" max="23" style="width:50px; padding: 5px;"> : 
                <input id="minute" type="number" min="0" max="59" style="width:50px; padding: 5px;"> ‡∏ô.
            </div>
        </div>
        <br>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div style="background: #f9f9f9; padding: 10px; border-radius: 8px;">
                <h3 style="margin: 0 0 10px 0;">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ 1: ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏û‡∏∑‡∏ä‡πÑ‡∏£‡πà (‡∏´‡πâ‡∏ß‡∏¢‡πÇ‡∏õ‡πà‡∏á)</h3>
                <label>‡∏Ñ‡πà‡∏≤ PM2.5 (¬µg/m¬≥):</label>
                <input id="pm1" type="number" step="0.1" placeholder="‡∏£‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç..." style="font-size: 18px; width: 100px; padding: 5px;">
            </div>
            <div style="background: #f9f9f9; padding: 10px; border-radius: 8px;">
                <h3 style="margin: 0 0 10px 0;">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ 2: ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ô‡∏¥‡∏ô‡∏û‡∏£‡∏∞)</h3>
                <label>‡∏Ñ‡πà‡∏≤ PM2.5 (¬µg/m¬≥):</label>
                <input id="pm2" type="number" step="0.1" placeholder="‡∏£‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç..." style="font-size: 18px; width: 100px; padding: 5px;">
            </div>
        </div>

        <div style="margin-top: 20px; text-align: center;">
            <button onclick="generateReport()" class="btn-gen">üìù ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button> 
            <button onclick="downloadImage()" class="btn-save">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û</button> 
        </div>
    </div>

   <div id="report" class="infographic a4" style="display:none;"> <div class="header-group">
            <img src="assets/logo.hrh.png" alt="Logo HRH" class="logo-hrh" onerror="this.style.display='none'">
            <img src="assets/logo.occ.png" alt="Logo OCC" class="logo-occ" onerror="this.style.display='none'">
            <div class="header-text">
                ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏û‡∏£‡∏∞‡πÄ‡∏ó‡∏û‡∏£‡∏±‡∏ï‡∏ô‡∏£‡∏≤‡∏ä‡∏™‡∏∏‡∏î‡∏≤‡∏Ø<br>
                ‡∏™‡∏¢‡∏≤‡∏°‡∏ö‡∏£‡∏°‡∏£‡∏≤‡∏ä‡∏Å‡∏∏‡∏°‡∏≤‡∏£‡∏µ ‡∏£‡∏∞‡∏¢‡∏≠‡∏á
            </div>
        </div>

        <h2>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ù‡∏∏‡πà‡∏ô PM <span style="font-size: 0.7em; vertical-align: sub;">2.5</span></h2>
        
        <div id="areaValue"></div>
        <div id="dateValue"></div>
        <div id="timeValue"></div>

        <div class="main-content">
            <div id="stations" class="stations"></div>

            <div class="right-sidebar">
                <img src="assets/Clinic_pic.png" alt="Clinic Pic" class="top-pic" onerror="this.style.display='none'">
            </div>
        </div>
        
        <img src="assets/5medthod.png" alt="5 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô" class="advice-img-standalone" onerror="this.style.display='none'">
        <img src="assets/advice_table.jpg" alt="‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥" class="advice-table-img-fixed" onerror="this.style.display='none'">

        <div id="report-footer-container">
            <h3 id="contactFooter">
                ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡∏©‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏ä‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏ß‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏°<br>
                ‡πÇ‡∏ó‡∏£ 038-684444 ‡∏ï‡πà‡∏≠ 3106 ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ 081-7814248
            </h3>
        </div>
        
    </div> 

    <script>
        // --- CONFIG: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Token WAQI ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ---
        const WAQI_TOKEN = 'c4f89be58184bd61e1adebd1d49c6a43f3321ca9'; 

        // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        function setInitialValues() {
            setNow();
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Manual Area ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            document.getElementById("areaSelector").addEventListener('change', function() {
                const manualInput = document.getElementById("manualAreaInput");
                if (this.value === "manual") {
                    manualInput.style.display = "block";
                    manualInput.focus();
                } else {
                    manualInput.style.display = "none";
                }
            });
        }
        
        function setNow() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            document.getElementById("date").value = `${yyyy}-${mm}-${dd}`;
            document.getElementById("hour").value = String(today.getHours()).padStart(2, '0');
            document.getElementById("minute").value = String(today.getMinutes()).padStart(2, '0');
        }

        // 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á API (WAQI)
        async function fetchWaqiData() {
            const btn = document.querySelector('.btn-api');
            const statusSpan = document.getElementById('api-status');
            const originalText = btn.innerText;
            
            btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...";
            btn.disabled = true;
            statusSpan.innerText = "";

            try {
                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πà‡∏≠‡∏¢‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ
                async function getStation(id) {
                    const res = await fetch(`https://api.waqi.info/feed/${id}/?token=${WAQI_TOKEN}`);
                    const json = await res.json();
                    if (json.status === 'ok') {
                        // **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç** ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ PM2.5 (iaqi.pm25.v) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ¬µg/m¬≥
                        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏î‡∏π‡∏Ñ‡πà‡∏≤ AQI (‡πÅ‡∏ï‡πà‡∏Ñ‡πà‡∏≤ AQI ‡∏à‡∏∞‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ PM2.5 ‡∏à‡∏£‡∏¥‡∏á)
                        if (json.data.iaqi && json.data.iaqi.pm25) {
                            return json.data.iaqi.pm25.v;
                        } else {
                            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ PM2.5 ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ AQI ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏µ
                            return json.data.aqi; 
                        }
                    }
                    return null;
                }

                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 2 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
                // @5819 = ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏û‡∏∑‡∏ä‡πÑ‡∏£‡πà‡∏£‡∏∞‡∏¢‡∏≠‡∏á (‡∏´‡πâ‡∏ß‡∏¢‡πÇ‡∏õ‡πà‡∏á)
                // @10502 = ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏≠‡∏á
                const [val1, val2] = await Promise.all([
                    getStation('@5819'),
                    getStation('@10502')
                ]);

                let log = "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:\n";

                if (val1 !== null) {
                    document.getElementById('pm1').value = val1;
                    log += "‚úÖ ‡∏´‡πâ‡∏ß‡∏¢‡πÇ‡∏õ‡πà‡∏á: " + val1 + "\n";
                } else {
                    log += "‚ö†Ô∏è ‡∏´‡πâ‡∏ß‡∏¢‡πÇ‡∏õ‡πà‡∏á: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n";
                }

                if (val2 !== null) {
                    document.getElementById('pm2').value = val2;
                    log += "‚úÖ ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£: " + val2 + "\n";
                } else {
                    log += "‚ö†Ô∏è ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n";
                }

                setNow(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡πâ‡∏ß‡∏¢
                alert(log);

            } catch (err) {
                console.error(err);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö (‡πÄ‡∏Å‡∏ì‡∏ë‡πå PM2.5 ‡πÑ‡∏ó‡∏¢ ‡πÉ‡∏´‡∏°‡πà 2023)
        function getLevel(pm) {
            // ‡πÄ‡∏Å‡∏ì‡∏ë‡πå: 0-15 (‡∏ü‡πâ‡∏≤), 15.1-25 (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß), 25.1-37.5 (‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á), 37.6-75 (‡∏™‡πâ‡∏°), >75 (‡πÅ‡∏î‡∏á)
            if (pm <= 15) return {text:"‡∏î‡∏µ‡∏°‡∏≤‡∏Å üòÉ", class:"good"};
            if (pm <= 25) return {text:"‡∏î‡∏µ üôÇ", class:"moderate"};
            if (pm <= 37.5) return {text:"‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á üòê", class:"unhealthy"};
            if (pm <= 75) return {text:"‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û üò´", class:"very-unhealthy"};
            return {text:"‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û üò°", class:"hazardous"};
        }

        // 4. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
        function generateReport() {
            // -- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà --
            let area = document.getElementById("areaSelector").value;
            if (area === "manual") area = document.getElementById("manualAreaInput").value;
            document.getElementById("areaValue").innerText = area;

            // -- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ --
            const dateVal = document.getElementById("date").value;
            if(dateVal) {
                const d = new Date(dateVal);
                const thMonth = ["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];
                document.getElementById("dateValue").innerText = `${d.getDate()} ${thMonth[d.getMonth()]} ${d.getFullYear()+543}`;
            }
            
            const hh = document.getElementById("hour").value.padStart(2,'0');
            const mm = document.getElementById("minute").value.padStart(2,'0');
            document.getElementById("timeValue").innerText = `${hh}:${mm} ‡∏ô.`;

            // -- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ --
            const stationData = [
                { name: "‡∏à‡∏∏‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏±‡∏î: ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏û‡∏∑‡∏ä‡πÑ‡∏£‡πà ‡∏ï.‡∏´‡πâ‡∏ß‡∏¢‡πÇ‡∏õ‡πà‡∏á", id: "pm1" },
                { name: "‡∏à‡∏∏‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏±‡∏î: ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏ï.‡πÄ‡∏ô‡∏¥‡∏ô‡∏û‡∏£‡∏∞", id: "pm2" }
            ];

            let html = "";
            stationData.forEach(s => {
                const val = parseFloat(document.getElementById(s.id).value);
                if (!isNaN(val)) {
                    const lv = getLevel(val);
                    // ‡πÅ‡∏¢‡∏Å Emoji ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Text
                    const emoji = lv.text.match(/[\u{1F600}-\u{1F64F}]/u)?.[0] || "";
                    const textOnly = lv.text.replace(emoji, "").trim();

                    html += `
                        <div class="station ${lv.class}">
                            <div class="station-name">${s.name}</div>
                            <div class="pm-highlight">‡∏Ñ‡πà‡∏≤ PM <span style="font-size:0.7em;">2.5</span> : ${val} ¬µg/m¬≥</div>
                            <div class="emoji">${emoji}</div>
                            <div class="level-highlight">‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${textOnly}</div>
                        </div>
                    `;
                }
            });

            document.getElementById("stations").innerHTML = html;
            document.getElementById("report").style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            
            // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏•‡∏á‡πÑ‡∏õ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
            document.getElementById("report").scrollIntoView({behavior: "smooth"});
        }

        // 5. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û
        function downloadImage() {
            const r = document.getElementById("report");
            html2canvas(r, { scale: 2, useCORS: true }).then(canvas => {
                const link = document.createElement("a");
                link.download = `PM2.5_Report_${new Date().toISOString().slice(0,10)}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        }
    </script>
</body>
</html>
